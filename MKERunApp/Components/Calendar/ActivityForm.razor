@inject ISnackbar Snackbar

<MudForm @ref="form">
    <MudStack>
        <MudNumericField @bind-Value="Minutes"
                         T="int"
                         Label="Minutes"
                         Required
                         RequiredError="Minutes is required." />

        @foreach (var group in TodaysActivities.GetGroups)
        {
            <MudCheckBox T="bool"
                         Value="TodaysActivities.GetSelectedGroups.Contains(group)"
                         ValueChanged="_ => TodaysActivities.ToggleSelectedGroup(group)"
                         Label="@group.Name"
                         Dense
                         Size="Size.Small"
                         Color="Color.Primary" />
        }

        <MudButton Color="Color.Primary"
                   OnClick="ClickSubmit">
            Submit
        </MudButton>
    </MudStack>
</MudForm>

@code {
    [Parameter] public bool Show { get; set; }
    [Parameter] public EventCallback<bool> ShowChanged { get; set; }

    [Parameter] [EditorRequired] public required CalendarDayActivities TodaysActivities { get; set; }

    private MudForm? form;
    private int Minutes;

    private async Task ClickSubmit()
    {
        form?.Validate();
        if (form?.IsValid ?? false)
        {
            try
            {
                await TodaysActivities.AddActivityWithMinutes(Minutes);
                await ShowChanged.InvokeAsync(false);
            }
            catch (Exception ex)
            {
                Snackbar.Add("Failed to save the activity", Severity.Error);
            }
        }
    }
}