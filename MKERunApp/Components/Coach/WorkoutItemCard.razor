<style>
    .remove-padding .mud-input-slot.mud-input-root.mud-input-root-filled.mud-input-root-margin-dense {
        padding-top: 6px !important;
    }


    .reduce-padding-mini-btns {
        padding: 4px;
    }

    .pop-over-class {
        background: none;
        box-shadow: none;
    }
</style>

<MudMenu ActivationEvent="@MouseEvent.MouseOver"
         DisableElevation
         AnchorOrigin="Origin.CenterCenter"
         TransformOrigin="Origin.CenterLeft"
         PopoverClass="pop-over-class"
         Class="py-2"
         Style="width:100%;cursor:grab">
    <ActivatorContent>
        <MudPaper Class="pa-1" Width="100%" Elevation="0" Style="cursor:grab">
            <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Spacing="0" Style="width:100%;cursor:grab">
                <MudIcon Icon="@Icons.Material.Filled.DragIndicator" Style="cursor:grab" />
                <div style="width:175px;">
                    <ActivitySelector @bind-ActivityType=ActivityType
                                      ShowLabel=false />
                </div>

                <MudSpacer />
                <div style="width:100px;z-index:3000">
                    <MudNumericField T="int"
                                     Min="0"
                                     HideSpinButtons
                                     Margin="Margin.Dense"
                                     Variant="Variant.Filled"
                                     Class="remove-padding"
                                     Adornment="Adornment.End"
                                     AdornmentText="@AdornmentString"
                                     DisableUnderLine />
                </div>
            </MudStack>
        </MudPaper>
    </ActivatorContent>
    <ChildContent>
        <MudIconButton OnClick="OnDelete"
                       Icon="@Icons.Material.Outlined.Delete"
                       Size="Size.Small"
                       Color="Color.Secondary"
                       Class="reduce-padding-mini-btns" />
        <MudIconButton OnClick=SetNextValue
                       Icon="@Icons.Material.Filled.Straighten"
                       Size="Size.Small"
                       Class="reduce-padding-mini-btns" />

    </ChildContent>
</MudMenu>

@code {
    [Parameter] public Action OnDelete { get; set; } = () => { };

    private ActivityType? ActivityType = ActivityType.GetActivityType(ActivityType.WorkoutType.None);

    private string AdornmentString = "";
    private IEnumerator<string>? AdornmentOptionsIterator;
    private List<string> AdornmentOptions = ["min", "mi", "km", "m", "s"];

    protected override void OnInitialized()
    {
        base.OnInitialized();
        InitializeIterator();
        SetNextValue();
    }

    private void SetNextValue()
    {
        if (AdornmentOptionsIterator is null) return;
        if (AdornmentOptionsIterator.MoveNext())
        {
            AdornmentString = AdornmentOptionsIterator.Current;
        }
        else
        {
            InitializeIterator();
            AdornmentOptionsIterator.MoveNext();
            AdornmentString = AdornmentOptionsIterator.Current;
        }
    }

    private void InitializeIterator()
    {
        AdornmentOptionsIterator = AdornmentOptions.GetEnumerator();
    }
}
